<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Library Management - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <style>
        /* Reset & Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #f5f7fa; color: #333; line-height: 1.6; }
        
        /* Header */
        header { background: linear-gradient(135deg, #2c3e50, #4a6491); color: white; padding: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo i { font-size: 32px; color: #4fc3f7; }
        .logo h1 { font-size: 26px; font-weight: 600; }
        .user-info { display: flex; align-items: center; gap: 20px; }
        .user-info span { font-size: 14px; opacity: 0.9; }
        .logout-btn { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .logout-btn:hover { background: rgba(255,255,255,0.25); }
        
        /* Navigation Tabs */
        .nav-tabs { display: flex; gap: 5px; background: rgba(255,255,255,0.1); border-radius: 30px; padding: 5px; margin-top: 20px; }
        .tab-btn { background: transparent; border: none; color: white; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: 500; transition: all 0.3s; display: flex; align-items: center; gap: 10px; }
        .tab-btn:hover { background: rgba(255,255,255,0.1); }
        .tab-btn.active { background: #4fc3f7; color: #2c3e50; }
        
        /* Main Content */
        .main-content { margin-top: 30px; }
        .app-container { background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); padding: 30px; display: none; }
        .app-container.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* App Title */
        .app-title { color: #2c3e50; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0; display: flex; align-items: center; gap: 15px; }
        .app-title i { color: #4fc3f7; font-size: 24px; }
        .app-title h2 { font-size: 24px; font-weight: 600; }
        
        /* Upload Section */
        .upload-section { margin-bottom: 40px; }
        .upload-tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 25px; }
        .upload-tab { padding: 12px 25px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 500; color: #666; transition: all 0.3s; }
        .upload-tab.active { color: #4fc3f7; border-bottom-color: #4fc3f7; }
        .upload-area { border: 3px dashed #ddd; border-radius: 12px; padding: 50px 30px; text-align: center; margin: 20px 0; transition: all 0.3s; cursor: pointer; }
        .upload-area:hover { border-color: #4fc3f7; background: #f9fdff; }
        .upload-area i { font-size: 56px; color: #aaa; margin-bottom: 20px; }
        .upload-area h3 { font-size: 22px; color: #555; margin-bottom: 10px; }
        .upload-area p { color: #777; font-size: 15px; }
        
        /* Google Drive Form */
        .drive-form { background: #f9f9f9; border-radius: 12px; padding: 30px; margin-top: 20px; }
        .drive-form h4 { color: #333; margin-bottom: 20px; font-size: 18px; display: flex; align-items: center; gap: 12px; }
        .drive-form h4 i { color: #4285F4; font-size: 22px; }
        
        /* Form Elements */
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 10px; font-weight: 500; color: #555; font-size: 15px; }
        .form-control { width: 100%; padding: 14px 18px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; transition: border 0.3s; }
        .form-control:focus { outline: none; border-color: #4fc3f7; box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.1); }
        textarea.form-control { resize: vertical; min-height: 100px; }
        
        /* Category Select */
        .category-select { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 15px; }
        .category-option { background: #f0f0f0; padding: 10px 18px; border-radius: 25px; cursor: pointer; transition: all 0.3s; font-size: 14px; display: flex; align-items: center; gap: 8px; border: 2px solid transparent; }
        .category-option:hover { background: #e0e0e0; }
        .category-option.selected { background: #4fc3f7; color: white; border-color: #4fc3f7; }
        
        /* Buttons */
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s; font-size: 15px; }
        .btn-primary { background: #4fc3f7; color: white; }
        .btn-primary:hover { background: #29b6f6; transform: translateY(-2px); }
        .btn-danger { background: #ff6b6b; color: white; }
        .btn-danger:hover { background: #ff5252; }
        .btn-success { background: #66bb6a; color: white; }
        .btn-success:hover { background: #4caf50; }
        .btn-warning { background: #ffa726; color: white; }
        .btn-warning:hover { background: #ff9800; }
        .btn-google { background: #4285F4; color: white; }
        .btn-google:hover { background: #3367D6; }
        .btn-sm { padding: 8px 15px; font-size: 13px; }
        
        /* Drive Link Preview */
        .drive-preview { background: #f0f7ff; border-radius: 8px; padding: 20px; margin-top: 20px; display: none; }
        .drive-preview.active { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .drive-preview h5 { color: #333; margin-bottom: 10px; font-size: 16px; }
        .drive-preview a { color: #4285F4; word-break: break-all; display: block; margin-bottom: 10px; text-decoration: none; }
        .drive-preview a:hover { text-decoration: underline; }
        
        /* Admin Sections Grid */
        .admin-sections { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 40px; }
        @media (max-width: 992px) { .admin-sections { grid-template-columns: 1fr; } }
        .section-card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .section-card h3 { color: #2c3e50; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 12px; }
        .section-card h3 i { color: #4fc3f7; font-size: 20px; }
        
        /* PDF List */
        .pdf-list { margin-top: 20px; max-height: 500px; overflow-y: auto; }
        .pdf-item { display: flex; align-items: center; padding: 20px; border-bottom: 1px solid #eee; transition: background 0.3s; }
        .pdf-item:hover { background: #f9f9f9; }
        .pdf-icon { background: #e3f2fd; width: 60px; height: 60px; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 20px; flex-shrink: 0; }
        .pdf-icon i { color: #f44336; font-size: 28px; }
        .pdf-info { flex: 1; min-width: 0; }
        .pdf-info h4 { font-size: 18px; color: #333; margin-bottom: 8px; }
        .pdf-info p { color: #777; font-size: 14px; line-height: 1.5; }
        .pdf-categories { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        
        /* Category Tags */
        .category-tag { background: #e8f5e9; color: #2e7d32; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .category-tag.technology { background: #e3f2fd; color: #1565c0; }
        .category-tag.business { background: #f3e5f5; color: #7b1fa2; }
        .category-tag.academic { background: #fff3e0; color: #ef6c00; }
        .category-tag.literature { background: #e8f5e9; color: #2e7d32; }
        .category-tag.science { background: #fce4ec; color: #c2185b; }
        .category-tag.history { background: #fff8e1; color: #ff8f00; }
        .category-tag.art { background: #f3e5f5; color: #7b1fa2; }
        .category-tag.health { background: #e8f5e9; color: #2e7d32; }
        
        /* PDF Actions */
        .pdf-actions { display: flex; gap: 12px; flex-shrink: 0; }
        
        /* Category Management */
        .category-list { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 25px; }
        .category-item { background: #f0f7ff; padding: 12px 20px; border-radius: 30px; display: flex; align-items: center; gap: 12px; border: 2px solid transparent; transition: all 0.3s; }
        .category-item:hover { background: #e1f0ff; border-color: #4fc3f7; }
        .category-actions { display: flex; gap: 8px; }
        
        /* Statistics */
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .stat-card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 20px; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-icon { width: 70px; height: 70px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0; }
        .stat-1 .stat-icon { background: #e3f2fd; color: #2196f3; }
        .stat-2 .stat-icon { background: #e8f5e9; color: #4caf50; }
        .stat-3 .stat-icon { background: #fff3e0; color: #ff9800; }
        .stat-info h3 { font-size: 36px; margin-bottom: 5px; color: #2c3e50; }
        .stat-info p { color: #777; font-size: 15px; }
        
        /* Activity Log */
        .activity-log { margin-top: 30px; }
        .activity-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 20px; flex-shrink: 0; font-size: 18px; }
        .activity-upload { background: #e8f5e9; color: #4caf50; }
        .activity-edit { background: #fff3e0; color: #ff9800; }
        .activity-delete { background: #ffebee; color: #f44336; }
        .activity-category { background: #e3f2fd; color: #2196f3; }
        .activity-login { background: #f3e5f5; color: #7b1fa2; }
        .activity-info { flex: 1; }
        .activity-info h4 { font-size: 16px; margin-bottom: 5px; color: #333; }
        .activity-info p { color: #888; font-size: 14px; }
        
        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; animation: fadeIn 0.3s ease; }
        .modal-content { background: white; border-radius: 12px; width: 90%; max-width: 700px; max-height: 90vh; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .modal-header { background: #2c3e50; color: white; padding: 25px; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 20px; font-weight: 600; }
        .modal-body { padding: 30px; max-height: 70vh; overflow-y: auto; }
        .close-modal { background: none; border: none; color: white; font-size: 28px; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.3s; }
        .close-modal:hover { background: rgba(255,255,255,0.1); }
        
        /* Loading Spinner */
        .spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Footer */
        footer { text-align: center; margin-top: 50px; padding: 25px; color: #777; border-top: 1px solid #eee; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; text-align: center; }
            .nav-tabs { flex-wrap: wrap; justify-content: center; }
            .pdf-item { flex-wrap: wrap; }
            .pdf-actions { width: 100%; margin-top: 15px; }
            .admin-sections { gap: 20px; }
            .modal-content { width: 95%; }
        }
        
        /* Empty States */
        .empty-state { text-align: center; padding: 50px 20px; color: #777; }
        .empty-state i { font-size: 60px; color: #ddd; margin-bottom: 20px; }
        .empty-state h4 { margin-bottom: 10px; color: #555; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen" style="display: none;">
        <div style="max-width: 400px; margin: 100px auto; background: white; border-radius: 15px; padding: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center;">
            <div style="font-size: 60px; color: #4fc3f7; margin-bottom: 20px;"><i class="fas fa-lock"></i></div>
            <h1 style="color: #2c3e50; margin-bottom: 30px; font-size: 28px;">Admin Login</h1>
            <form id="loginForm">
                <input type="text" id="adminId" placeholder="Admin ID" style="width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; font-size: 16px;" value="mahamud5545">
                <input type="password" id="adminPassword" placeholder="Password" style="width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; font-size: 16px;" value="545545">
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 16px;" id="loginBtn">
                    <span id="loginText">Login</span>
                    <div class="spinner" id="loginSpinner" style="display: none;"></div>
                </button>
                <div id="loginError" style="color: #ff6b6b; margin-top: 15px; font-size: 14px; display: none;"></div>
            </form>
            <div style="margin-top: 25px; color: #666; font-size: 14px; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                <p><strong>Default Credentials:</strong></p>
                <p>ID: <strong>mahamud5545</strong></p>
                <p>Password: <strong>545545</strong></p>
                <p style="margin-top: 10px; font-size: 12px; color: #888;">Email: admin@rds-library.com</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-book-open"></i>
                        <h1>PDF Library Admin</h1>
                    </div>
                    <div class="user-info">
                        <span>Welcome, <strong id="loggedInUser">Admin</strong></span>
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
                <div class="nav-tabs">
                    <button class="tab-btn active" data-tab="admin">
                        <i class="fas fa-user-shield"></i> Admin Panel
                    </button>
                    <button class="tab-btn" data-tab="stats">
                        <i class="fas fa-chart-bar"></i> Statistics
                    </button>
                </div>
            </div>
        </header>

        <div class="container main-content">
            <!-- Admin Panel -->
            <div class="app-container active" id="admin">
                <div class="app-title">
                    <i class="fas fa-user-cog"></i>
                    <h2>PDF & Category Management</h2>
                </div>

                <!-- Upload Section -->
                <div class="upload-section">
                    <div class="upload-tabs">
                        <button class="upload-tab active" data-upload-type="drive">Google Drive Upload</button>
                        <button class="upload-tab" data-upload-type="file">File Upload</button>
                    </div>

                    <!-- Google Drive Form -->
                    <div id="driveUploadForm">
                        <div class="drive-form">
                            <h4><i class="fab fa-google-drive"></i> Add PDF from Google Drive</h4>
                            
                            <div class="form-group">
                                <label for="driveLink">Google Drive Shareable Link</label>
                                <input type="text" id="driveLink" class="form-control" placeholder="https://drive.google.com/file/d/XXXXX/view?usp=sharing">
                                <small style="color: #666; display: block; margin-top: 8px;">Make sure the link is set to "Anyone with the link can view"</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="drivePdfName">PDF Name</label>
                                <input type="text" id="drivePdfName" class="form-control" placeholder="Enter PDF name">
                            </div>
                            
                            <div class="form-group">
                                <label for="drivePdfDescription">Description</label>
                                <textarea id="drivePdfDescription" class="form-control" rows="3" placeholder="Enter PDF description"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Select Categories</label>
                                <div class="category-select" id="driveCategorySelect">
                                    <!-- Categories will be loaded here -->
                                </div>
                            </div>
                            
                            <button class="btn btn-google" id="addDrivePdfBtn">
                                <i class="fab fa-google-drive"></i> Add from Google Drive
                            </button>
                            
                            <div class="drive-preview" id="driveLinkPreview">
                                <h5>Link Preview:</h5>
                                <a id="previewDriveLink" href="#" target="_blank">Link will appear here</a>
                                <p style="font-size: 13px; color: #666; margin-top: 5px;">Click to test the link</p>
                            </div>
                        </div>
                    </div>

                    <!-- File Upload Form -->
                    <div id="fileUploadForm" style="display: none;">
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h3>Upload PDF Files</h3>
                            <p>Drag & drop PDF files here or click to browse</p>
                            <input type="file" id="fileInput" accept=".pdf" style="display: none;" multiple>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <p style="color: #666; font-size: 14px;">Maximum file size: 10MB per file</p>
                        </div>
                    </div>
                </div>

                <!-- Management Sections -->
                <div class="admin-sections">
                    <!-- PDF Management -->
                    <div class="section-card">
                        <h3><i class="fas fa-file-pdf"></i> PDF Management</h3>
                        
                        <div class="form-group">
                            <label for="categoryFilter">Filter by Category</label>
                            <select id="categoryFilter" class="form-control">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                        
                        <div class="pdf-list" id="pdfListContainer">
                            <div class="empty-state">
                                <i class="fas fa-file-pdf"></i>
                                <h4>No PDFs Found</h4>
                                <p>Upload some PDFs to get started</p>
                            </div>
                        </div>
                    </div>

                    <!-- Category Management -->
                    <div class="section-card">
                        <h3><i class="fas fa-tags"></i> Category Management</h3>
                        
                        <div class="form-group">
                            <label for="newCategoryName">Add New Category</label>
                            <div style="display: flex; gap: 12px;">
                                <input type="text" id="newCategoryName" class="form-control" placeholder="Enter category name">
                                <button class="btn btn-success" id="addCategoryBtn">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                        </div>
                        
                        <div class="category-list" id="categoryListContainer">
                            <div class="empty-state">
                                <i class="fas fa-tags"></i>
                                <h4>No Categories</h4>
                                <p>Add some categories first</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Panel -->
            <div class="app-container" id="stats">
                <div class="app-title">
                    <i class="fas fa-chart-pie"></i>
                    <h2>Library Statistics</h2>
                </div>

                <div class="stats-container">
                    <div class="stat-card stat-1">
                        <div class="stat-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalPdfs">0</h3>
                            <p>Total PDFs</p>
                        </div>
                    </div>
                    
                    <div class="stat-card stat-2">
                        <div class="stat-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalCategories">0</h3>
                            <p>Categories</p>
                        </div>
                    </div>
                    
                    <div class="stat-card stat-3">
                        <div class="stat-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalDownloads">0</h3>
                            <p>Total Downloads</p>
                        </div>
                    </div>
                </div>

                <div class="activity-log">
                    <h3 style="margin-bottom: 25px; color: #2c3e50; font-size: 20px;">Recent Activity</h3>
                    <div id="activityLog">
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <h4>No Activity Yet</h4>
                            <p>Activities will appear here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PDF Editor Modal -->
        <div class="modal" id="pdfEditorModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit PDF Details</h3>
                    <button class="close-modal" id="closeEditorModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="editPdfName">PDF Name</label>
                        <input type="text" id="editPdfName" class="form-control" placeholder="Enter PDF name">
                    </div>
                    
                    <div class="form-group">
                        <label for="editPdfDescription">Description</label>
                        <textarea id="editPdfDescription" class="form-control" rows="3" placeholder="Enter PDF description"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Select Categories</label>
                        <div class="category-select" id="categorySelectContainer">
                            <!-- Categories will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="form-group" id="editDriveLinkSection" style="display: none;">
                        <label for="editDriveLink">Google Drive Link</label>
                        <input type="text" id="editDriveLink" class="form-control" placeholder="Google Drive link">
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                        <button class="btn btn-primary" id="savePdfChangesBtn">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button class="btn" id="cancelEditBtn" style="background: #f0f0f0;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="container">
                <p>PDF Library Management System &copy; 2023 | Admin Panel</p>
                <p style="font-size: 14px; margin-top: 10px; color: #999;">
                    Connected to Firebase Project: <strong>rds-library</strong>
                </p>
            </div>
        </footer>
    </div>

    <script>
        // ================ FIREBASE CONFIGURATION ================
        const firebaseConfig = {
           apiKey: "AIzaSyBPAujSIQnIdXOhAGV1zwafvFiZr6z5u0Y",
  authDomain: "rds-library-3a1b0.firebaseapp.com",
    databaseURL: "https://rds-library-3a1b0-default-rtdb.firebaseio.com/",
    projectId: "rds-library-3a1b0",
  storageBucket: "rds-library-3a1b0.firebasestorage.app",
  messagingSenderId: "258223710686",
  appId: "1:258223710686:web:68872b10e298741b7dbd4f",
  measurementId: "G-1KTQSJGBP6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        console.log("Firebase initialized successfully!");

        // ================ GLOBAL VARIABLES ================
        let categories = [];
        let pdfs = [];
        let editingPdfId = null;
        let currentUser = null;

        // ================ AUTHENTICATION ================
        // Check auth state on load
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                currentUser = user;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('loggedInUser').textContent = "mahamud5545";
                initAdminApp();
                addActivity("Admin logged in", "login");
            } else {
                // User is signed out
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
        });

        // Login form submission
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const adminId = document.getElementById('adminId').value;
            const password = document.getElementById('adminPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginText = document.getElementById('loginText');
            const spinner = document.getElementById('loginSpinner');
            const errorDiv = document.getElementById('loginError');
            
            // Show loading
            loginText.style.display = 'none';
            spinner.style.display = 'inline-block';
            loginBtn.disabled = true;
            errorDiv.style.display = 'none';
            
            try {
                // Hardcoded credentials for Firebase auth
                const adminEmail = "admin@rds-library.com";
                const adminPass = "545545";
                
                // Sign in with Firebase
                const userCredential = await auth.signInWithEmailAndPassword(adminEmail, adminPass);
                const user = userCredential.user;
                
                console.log("Login successful:", user);
                
                // Create/update admin record in database
                await database.ref('users/' + user.uid).set({
                    username: adminId,
                    isAdmin: true,
                    email: user.email,
                    lastLogin: new Date().toISOString()
                });
                
            } catch (error) {
                console.error("Login error:", error);
                
                let errorMessage = "Login failed: ";
                switch(error.code) {
                    case 'auth/user-not-found':
                        errorMessage = "❌ User not found. Please create user in Firebase Console:<br>" +
                                      "Email: admin@rds-library.com<br>" +
                                      "Password: 545545";
                        break;
                    case 'auth/wrong-password':
                        errorMessage = "❌ Wrong password. Use: 545545";
                        break;
                    case 'auth/invalid-email':
                        errorMessage = "❌ Invalid email format";
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = "❌ Network error. Check internet connection.";
                        break;
                    default:
                        errorMessage = "❌ " + error.message;
                }
                
                errorDiv.innerHTML = errorMessage;
                errorDiv.style.display = 'block';
                
                // Reset button
                loginText.style.display = 'inline';
                spinner.style.display = 'none';
                loginBtn.disabled = false;
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm("Are you sure you want to logout?")) {
                auth.signOut();
            }
        });

        // ================ INITIALIZE ADMIN APP ================
        function initAdminApp() {
            console.log("Initializing admin app...");
            
            // Load initial data
            loadCategories();
            loadPDFs();
            
            // Setup event listeners
            setupEventListeners();
            
            // Auto-select first tab
            document.querySelector('.tab-btn.active').click();
        }

        // ================ CATEGORY MANAGEMENT ================
        function loadCategories() {
            database.ref('categories').on('value', (snapshot) => {
                categories = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        categories.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                }
                renderCategories();
                updateStats();
            });
        }

        function renderCategories() {
            const container = document.getElementById('categoryListContainer');
            const filterSelect = document.getElementById('categoryFilter');
            const driveSelect = document.getElementById('driveCategorySelect');
            
            // Clear containers
            container.innerHTML = '';
            filterSelect.innerHTML = '<option value="all">All Categories</option>';
            driveSelect.innerHTML = '';
            
            if (categories.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-tags"></i><h4>No Categories</h4><p>Add some categories first</p></div>';
                return;
            }
            
            // Render each category
            categories.forEach(category => {
                // Add to category list
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-item';
                categoryElement.innerHTML = `
                    <span class="category-tag ${category.color || 'technology'}">${category.name}</span>
                    <div class="category-actions">
                        <button class="btn btn-warning btn-sm" onclick="editCategory('${category.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCategory('${category.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(categoryElement);
                
                // Add to filter select
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                filterSelect.appendChild(option);
                
                // Add to drive upload category select
                const driveOption = document.createElement('div');
                driveOption.className = 'category-option';
                driveOption.setAttribute('data-id', category.id);
                driveOption.innerHTML = `
                    <i class="fas fa-circle"></i>
                    ${category.name}
                `;
                
                driveOption.addEventListener('click', () => {
                    driveOption.classList.toggle('selected');
                });
                
                driveSelect.appendChild(driveOption);
            });
        }

        // Add new category
        document.getElementById('addCategoryBtn').addEventListener('click', function() {
            const nameInput = document.getElementById('newCategoryName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Please enter a category name');
                return;
            }
            
            // Check if category already exists
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                alert('Category already exists!');
                return;
            }
            
            // Define color classes
            const colorClasses = ['technology', 'business', 'academic', 'literature', 'science', 'history', 'art', 'health'];
            const usedColors = categories.map(cat => cat.color).filter(Boolean);
            let availableColor = colorClasses.find(color => !usedColors.includes(color));
            
            // If all colors are used, use random
            if (!availableColor) availableColor = colorClasses[Math.floor(Math.random() * colorClasses.length)];
            
            // Add category to Firebase
            const newCategoryRef = database.ref('categories').push();
            newCategoryRef.set({
                name: name,
                color: availableColor,
                created: new Date().toISOString()
            }).then(() => {
                nameInput.value = '';
                addActivity(`Added category: "${name}"`, 'category');
                alert('Category added successfully!');
            }).catch(error => {
                console.error("Error adding category:", error);
                alert('Failed to add category. Check console for details.');
            });
        });

        // Edit category
        window.editCategory = function(id) {
            const category = categories.find(c => c.id === id);
            if (!category) return;
            
            const newName = prompt("Enter new name for the category:", category.name);
            if (newName && newName.trim() !== '') {
                database.ref('categories/' + id).update({
                    name: newName.trim(),
                    updated: new Date().toISOString()
                }).then(() => {
                    addActivity(`Renamed category to: "${newName}"`, 'edit');
                }).catch(error => {
                    console.error("Error updating category:", error);
                    alert('Failed to update category.');
                });
            }
        };

        // Delete category
        window.deleteCategory = function(id) {
            const category = categories.find(c => c.id === id);
            if (!category) return;
            
            // Check if category is in use
            const isCategoryInUse = pdfs.some(pdf => pdf.categories && pdf.categories.includes(id));
            
            if (isCategoryInUse) {
                alert('Cannot delete this category because it is assigned to one or more PDFs. Please reassign those PDFs first.');
                return;
            }
            
            if (confirm(`Are you sure you want to delete the category "${category.name}"?`)) {
                database.ref('categories/' + id).remove().then(() => {
                    addActivity(`Deleted category: "${category.name}"`, 'delete');
                }).catch(error => {
                    console.error("Error deleting category:", error);
                    alert('Failed to delete category.');
                });
            }
        };

        // ================ PDF MANAGEMENT ================
        function loadPDFs() {
            database.ref('pdfs').on('value', (snapshot) => {
                pdfs = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        pdfs.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                }
                renderAdminPdfList();
                updateStats();
            });
        }

        function renderAdminPdfList() {
            const container = document.getElementById('pdfListContainer');
            const filter = document.getElementById('categoryFilter').value;
            
            // Filter PDFs
            let filteredPdfs = pdfs;
            if (filter !== 'all') {
                filteredPdfs = pdfs.filter(pdf => pdf.categories && pdf.categories.includes(filter));
            }
            
            if (filteredPdfs.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-file-pdf"></i><h4>No PDFs Found</h4><p>Upload some PDFs to get started</p></div>';
                return;
            }
            
            let html = '';
            filteredPdfs.forEach(pdf => {
                // Get category names for this PDF
                const pdfCategories = categories.filter(cat => pdf.categories && pdf.categories.includes(cat.id));
                
                // Format date
                const formattedDate = pdf.uploadDate ? new Date(pdf.uploadDate).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                }) : 'N/A';
                
                html += `
                <div class="pdf-item" data-id="${pdf.id}">
                    <div class="pdf-icon">
                        <i class="fas fa-file-pdf"></i>
                        ${pdf.type === 'drive' ? '<i class="fab fa-google-drive" style="color: #4285F4; font-size: 16px; margin-left: 2px;"></i>' : ''}
                    </div>
                    <div class="pdf-info">
                        <h4>${pdf.name}</h4>
                        <p>
                            ${pdf.type === 'drive' ? '<i class="fab fa-google-drive" style="color: #4285F4; font-size: 12px;"></i> Google Drive' : '<i class="fas fa-file-upload" style="color: #666; font-size: 12px;"></i> File Upload'} 
                            • Size: ${pdf.size || 'N/A'} 
                            • Uploaded: ${formattedDate}
                            • Downloads: ${pdf.downloads || 0}
                        </p>
                        ${pdf.description ? `<p style="color: #666; margin-top: 8px; font-size: 13px;">${pdf.description}</p>` : ''}
                        <div class="pdf-categories">
                            ${pdfCategories.map(cat => 
                                `<span class="category-tag ${cat.color || 'technology'}">${cat.name}</span>`
                            ).join('')}
                        </div>
                    </div>
                    <div class="pdf-actions">
                        <button class="btn btn-primary" onclick="openEditPdfModal('${pdf.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger" onclick="deletePdf('${pdf.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Add PDF from Google Drive
        document.getElementById('addDrivePdfBtn').addEventListener('click', async function() {
            const link = document.getElementById('driveLink').value.trim();
            const name = document.getElementById('drivePdfName').value.trim();
            const description = document.getElementById('drivePdfDescription').value.trim();
            
            // Get selected categories
            const selectedOptions = document.querySelectorAll('#driveCategorySelect .category-option.selected');
            const selectedCategoryIds = [];
            
            selectedOptions.forEach(option => {
                const categoryId = option.getAttribute('data-id');
                if (categoryId) selectedCategoryIds.push(categoryId);
            });
            
            // Validation
            if (!link) {
                alert('Please enter a Google Drive link');
                return;
            }
            
            if (!link.includes('drive.google.com')) {
                alert('Please enter a valid Google Drive link');
                return;
            }
            
            if (!name) {
                alert('Please enter a PDF name');
                return;
            }
            
            if (selectedCategoryIds.length === 0) {
                alert('Please select at least one category');
                return;
            }
            
            try {
                // Add PDF to Firebase
                const newPdfRef = database.ref('pdfs').push();
                await newPdfRef.set({
                    name: name,
                    description: description,
                    driveLink: link,
                    categories: selectedCategoryIds,
                    type: 'drive',
                    size: 'Google Drive',
                    uploadDate: new Date().toISOString().split('T')[0],
                    downloads: 0,
                    created: new Date().toISOString(),
                    createdBy: currentUser.uid
                });
                
                // Clear form
                document.getElementById('driveLink').value = '';
                document.getElementById('drivePdfName').value = '';
                document.getElementById('drivePdfDescription').value = '';
                document.getElementById('driveLinkPreview').classList.remove('active');
                
                // Unselect all categories
                selectedOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                
                addActivity(`Added PDF from Google Drive: "${name}"`, 'upload');
                alert('PDF added successfully!');
                
            } catch (error) {
                console.error('Error adding PDF:', error);
                alert('Failed to add PDF. Check console for details.');
            }
        });

        // Google Drive link preview
        document.getElementById('driveLink').addEventListener('input', function() {
            const previewContainer = document.getElementById('driveLinkPreview');
            const previewLink = document.getElementById('previewDriveLink');
            
            if (this.value && this.value.includes('drive.google.com')) {
                previewContainer.classList.add('active');
                previewLink.href = this.value;
                previewLink.textContent = this.value.length > 60 ? this.value.substring(0, 60) + '...' : this.value;
            } else {
                previewContainer.classList.remove('active');
            }
        });

        // Open edit PDF modal
        window.openEditPdfModal = function(id) {
            const pdf = pdfs.find(p => p.id === id);
            if (!pdf) return;
            
            editingPdfId = id;
            document.getElementById('editPdfName').value = pdf.name;
            document.getElementById('editPdfDescription').value = pdf.description || '';
            document.getElementById('editDriveLink').value = pdf.driveLink || '';
            
            // Show/hide Google Drive link field
            const driveLinkSection = document.getElementById('editDriveLinkSection');
            if (pdf.type === 'drive') {
                driveLinkSection.style.display = 'block';
            } else {
                driveLinkSection.style.display = 'none';
            }
            
            // Render category options
            const container = document.getElementById('categorySelectContainer');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const isSelected = pdf.categories && pdf.categories.includes(category.id);
                const option = document.createElement('div');
                option.className = `category-option ${isSelected ? 'selected' : ''}`;
                option.setAttribute('data-id', category.id);
                option.innerHTML = `
                    <i class="fas fa${isSelected ? '-check' : ''}-circle"></i>
                    ${category.name}
                `;
                
                option.addEventListener('click', () => {
                    option.classList.toggle('selected');
                });
                
                container.appendChild(option);
            });
            
            // Show modal
            document.getElementById('pdfEditorModal').classList.add('active');
        };

        // Save PDF changes
        document.getElementById('savePdfChangesBtn').addEventListener('click', async function() {
            const name = document.getElementById('editPdfName').value.trim();
            const description = document.getElementById('editPdfDescription').value.trim();
            const driveLink = document.getElementById('editDriveLink').value.trim();
            
            // Get selected categories
            const selectedOptions = document.querySelectorAll('#categorySelectContainer .category-option.selected');
            const selectedCategoryIds = [];
            
            selectedOptions.forEach(option => {
                const categoryId = option.getAttribute('data-id');
                if (categoryId) selectedCategoryIds.push(categoryId);
            });
            
            if (!name) {
                alert('Please enter a PDF name');
                return;
            }
            
            if (selectedCategoryIds.length === 0) {
                alert('Please select at least one category');
                return;
            }
            
            try {
                const updates = {
                    name: name,
                    description: description,
                    categories: selectedCategoryIds,
                    updated: new Date().toISOString(),
                    updatedBy: currentUser.uid
                };
                
                // Only update driveLink if it's a drive PDF
                const pdf = pdfs.find(p => p.id === editingPdfId);
                if (pdf.type === 'drive' && driveLink) {
                    updates.driveLink = driveLink;
                }
                
                await database.ref('pdfs/' + editingPdfId).update(updates);
                
                document.getElementById('pdfEditorModal').classList.remove('active');
                addActivity(`Updated PDF: "${name}"`, 'edit');
                alert('PDF updated successfully!');
                
            } catch (error) {
                console.error('Error updating PDF:', error);
                alert('Failed to update PDF. Check console for details.');
            }
        });

        // Delete PDF
        window.deletePdf = function(id) {
            const pdf = pdfs.find(p => p.id === id);
            if (!pdf) return;
            
            if (confirm(`Are you sure you want to delete "${pdf.name}"?`)) {
                database.ref('pdfs/' + id).remove().then(() => {
                    addActivity(`Deleted PDF: "${pdf.name}"`, 'delete');
                }).catch(error => {
                    console.error("Error deleting PDF:", error);
                    alert('Failed to delete PDF.');
                });
            }
        };

        // File upload functionality
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        
        async function handleFileUpload(e) {
            const files = e.target.files;
            let uploadedCount = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Check if it's a PDF
                if (file.type !== 'application/pdf') {
                    alert(`"${file.name}" is not a PDF file. Skipping.`);
                    continue;
                }
                
                // Check file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert(`"${file.name}" is too large (max 10MB). Skipping.`);
                    continue;
                }
                
                try {
                    // Create storage reference
                    const fileRef = storage.ref('pdfs/' + Date.now() + '_' + file.name.replace(/[^a-zA-Z0-9.-]/g, '_'));
                    
                    // Upload the file
                    const snapshot = await fileRef.put(file);
                    
                    // Get download URL
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    
                    // Get first category ID or create default
                    let categoryIds = [];
                    if (categories.length > 0) {
                        categoryIds = [categories[0].id];
                    }
                    
                    // Add to database
                    const newPdfRef = database.ref('pdfs').push();
                    await newPdfRef.set({
                        name: file.name.replace('.pdf', ''),
                        description: 'Uploaded PDF file',
                        fileURL: downloadURL,
                        categories: categoryIds,
                        type: 'file',
                        size: formatFileSize(file.size),
                        uploadDate: new Date().toISOString().split('T')[0],
                        downloads: 0,
                        created: new Date().toISOString(),
                        createdBy: currentUser.uid
                    });
                    
                    uploadedCount++;
                    addActivity(`Uploaded file: "${file.name}"`, 'upload');
                    
                } catch (error) {
                    console.error('Error uploading file:', error);
                    alert(`Failed to upload "${file.name}": ${error.message}`);
                }
            }
            
            if (uploadedCount > 0) {
                alert(`${uploadedCount} PDF file(s) uploaded successfully!`);
            }
            
            // Reset file input
            e.target.value = '';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // ================ STATISTICS ================
        function updateStats() {
            document.getElementById('totalPdfs').textContent = pdfs.length;
            document.getElementById('totalCategories').textContent = categories.length;
            
            let totalDownloads = 0;
            pdfs.forEach(pdf => {
                totalDownloads += pdf.downloads || 0;
            });
            
            document.getElementById('totalDownloads').textContent = totalDownloads;
        }

        // ================ ACTIVITY LOG ================
        function addActivity(text, type) {
            const log = document.getElementById('activityLog');
            
            // Remove empty state if present
            const emptyState = log.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const dateString = now.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
            
            // Determine icon and color based on activity type
            let iconClass = 'fas fa-history';
            let bgClass = 'activity-upload';
            
            if (type === 'edit') {
                iconClass = 'fas fa-edit';
                bgClass = 'activity-edit';
            } else if (type === 'delete') {
                iconClass = 'fas fa-trash';
                bgClass = 'activity-delete';
            } else if (type === 'category') {
                iconClass = 'fas fa-tag';
                bgClass = 'activity-category';
            } else if (type === 'login') {
                iconClass = 'fas fa-sign-in-alt';
                bgClass = 'activity-login';
            }
            
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
                <div class="activity-icon ${bgClass}">
                    <i class="${iconClass}"></i>
                </div>
                <div class="activity-info">
                    <h4>${text}</h4>
                    <p>${timeString} • ${dateString}</p>
                </div>
            `;
            
            log.insertBefore(activityItem, log.firstChild);
            
            // Limit to 20 activities
            if (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
            
            // Also save to database
            if (currentUser) {
                database.ref('activities').push({
                    text: text,
                    type: type,
                    timestamp: new Date().toISOString(),
                    user: currentUser.uid,
                    userEmail: currentUser.email
                });
            }
        }

        // ================ EVENT LISTENERS SETUP ================
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    
                    // Update active tab button
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Show the selected app container
                    document.querySelectorAll('.app-container').forEach(container => {
                        container.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Upload tab switching
            document.querySelectorAll('.upload-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const uploadType = tab.getAttribute('data-upload-type');
                    
                    // Update active tab
                    document.querySelectorAll('.upload-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show the selected upload form
                    document.getElementById('driveUploadForm').style.display = uploadType === 'drive' ? 'block' : 'none';
                    document.getElementById('fileUploadForm').style.display = uploadType === 'file' ? 'block' : 'none';
                });
            });
            
            // Category filter change
            document.getElementById('categoryFilter').addEventListener('change', renderAdminPdfList);
            
            // Modal close buttons
            document.getElementById('closeEditorModal').addEventListener('click', () => {
                document.getElementById('pdfEditorModal').classList.remove('active');
            });
            
            document.getElementById('cancelEditBtn').addEventListener('click', () => {
                document.getElementById('pdfEditorModal').classList.remove('active');
            });
            
            // Drag and drop file upload
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#4fc3f7';
                uploadArea.style.background = '#f0f9ff';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = '#ddd';
                uploadArea.style.background = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#ddd';
                uploadArea.style.background = '';
                
                const files = e.dataTransfer.files;
                const fileInput = document.getElementById('fileInput');
                
                // Create a DataTransfer object to set files
                const dataTransfer = new DataTransfer();
                for (let i = 0; i < files.length; i++) {
                    dataTransfer.items.add(files[i]);
                }
                fileInput.files = dataTransfer.files;
                
                // Trigger change event
                const event = new Event('change', { bubbles: true });
                fileInput.dispatchEvent(event);
            });
            
            // Load activities from database
            database.ref('activities').limitToLast(20).on('value', (snapshot) => {
                const log = document.getElementById('activityLog');
                
                if (!snapshot.exists()) {
                    if (log.children.length === 0) {
                        log.innerHTML = '<div class="empty-state"><i class="fas fa-history"></i><h4>No Activity Yet</h4><p>Activities will appear here</p></div>';
                    }
                    return;
                }
                
                // Clear existing activities (except the ones added during session)
                const currentActivities = Array.from(log.children).filter(child => 
                    !child.classList.contains('empty-state')
                );
                
                // We'll keep the in-memory activities and add database ones
                // This prevents duplication
            });
        }

        // ================ INITIALIZE ON LOAD ================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded, checking auth state...");
            
            // Check if user is already logged in
            const user = auth.currentUser;
            if (user) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('loggedInUser').textContent = "mahamud5545";
                initAdminApp();
            }
        });
    </script>
</body>
</html>
