<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MRDS Ultimate v6.2 - PDF Library Updated</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <style>
        :root {
            --primary: #4f46e5; 
            --primary-dark: #3730a3;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f3f4f6; 
            --surface: #ffffff; 
            --text: #1f2937; 
            --text-light: #6b7280;
            --border: #e5e7eb; 
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Segoe UI', 'Noto Sans Bengali', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body { 
            background: var(--bg); 
            color: var(--text); 
            padding-bottom: 80px; 
            font-size: 15px; 
            line-height: 1.5;
        }

        .hidden { display: none !important; }
        .flex { display: flex; align-items: center; }
        .flex-between { justify-content: space-between; }
        .flex-center { justify-content: center; }
        .flex-column { flex-direction: column; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap: 16px; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-center { text-align: center; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-4 { margin-bottom: 16px; }
        .p-4 { padding: 16px; }
        
        .card { 
            background: var(--surface); 
            padding: 16px; 
            border-radius: var(--radius); 
            box-shadow: var(--shadow); 
            margin-bottom: 12px; 
            border: 1px solid var(--border); 
        }
        
        .btn {
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 12px 16px; 
            border-radius: 8px;
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 8px; 
            width: 100%;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-sm { 
            padding: 8px 12px; 
            font-size: 0.85rem; 
            width: auto; 
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        input, select, textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid var(--border); 
            border-radius: 8px; 
            background: #f9fafb; 
            margin-bottom: 12px; 
            outline: none; 
            font-size: 0.95rem;
            transition: border 0.2s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            background: white;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text);
        }
        
        /* Navbar & Navigation */
        .navbar { 
            position: sticky; 
            top: 0; 
            background: var(--surface); 
            padding: 14px 16px; 
            border-bottom: 1px solid var(--border); 
            z-index: 100; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }
        
        .logo {
            font-weight: 800; 
            color: var(--primary); 
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo i {
            font-size: 1.1rem;
        }
        
        .bottom-nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            background: var(--surface); 
            border-top: 1px solid var(--border); 
            display: flex; 
            justify-content: space-around; 
            padding: 12px 0; 
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .nav-item { 
            background: none; 
            border: none; 
            color: var(--text-light); 
            font-size: 0.75rem; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            cursor: pointer;
            padding: 4px 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .nav-item.active { 
            color: var(--primary); 
            font-weight: 600;
            background: rgba(79, 70, 229, 0.1);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        /* PDF Library Styling */
        .pdf-card { 
            display: flex; 
            align-items: center; 
            gap: 14px;
            transition: transform 0.2s ease;
        }
        
        .pdf-card:hover {
            transform: translateX(4px);
        }
        
        .pdf-icon { 
            width: 50px; 
            height: 50px; 
            background: #fee2e2; 
            color: #ef4444; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.6rem; 
            flex-shrink: 0;
        }
        
        .pdf-icon.video {
            background: #dbeafe;
            color: #3b82f6;
        }
        
        .pdf-icon.note {
            background: #dcfce7;
            color: #10b981;
        }
        
        .pdf-info {
            flex: 1;
            min-width: 0; /* For text truncation */
        }
        
        .pdf-title {
            margin: 0 0 4px 0; 
            font-size: 15px; 
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .pdf-meta {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .pdf-type {
            background: rgba(79, 70, 229, 0.1);
            color: var(--primary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        
        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            color: #d1d5db;
        }
        
        /* Admin Panel */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .admin-header h2 {
            font-size: 1.3rem;
            color: var(--primary);
        }
        
        .form-section {
            margin-bottom: 24px;
        }
        
        .form-section h4 {
            margin-bottom: 12px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* File Upload Area */
        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 24px;
            text-align: center;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(79, 70, 229, 0.02);
        }
        
        .file-upload-area i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .file-upload-area p {
            margin-bottom: 8px;
            color: var(--text);
        }
        
        .file-upload-area small {
            color: var(--text-light);
        }
        
        .file-selected {
            background: #f0f9ff;
            border-color: var(--primary);
            border-style: solid;
        }
        
        .file-name {
            font-weight: 500;
            color: var(--primary);
            margin-top: 8px;
            word-break: break-all;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface);
            padding: 16px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 350px;
            border-left: 4px solid var(--primary);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast i {
            font-size: 1.3rem;
            color: var(--primary);
        }
        
        .toast.success {
            border-left-color: var(--success);
        }
        
        .toast.success i {
            color: var(--success);
        }
        
        .toast.error {
            border-left-color: var(--danger);
        }
        
        .toast.error i {
            color: var(--danger);
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .p-4 { padding: 12px; }
            .card { padding: 14px; }
            .pdf-title { font-size: 14px; }
            .pdf-icon { width: 45px; height: 45px; font-size: 1.4rem; }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <span>MRDS v6.2</span>
        </div>
        <div id="userStatus" class="flex gap-2">
            <span id="navBal" style="font-weight: bold; color: var(--success);">৳0</span>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="p-4">
        
        <!-- Library View -->
        <div id="view-library" class="view">
            <div class="admin-header">
                <h2><i class="fas fa-book-open"></i> স্টাডি লাইব্রেরি</h2>
                <button class="btn btn-sm btn-outline" onclick="refreshLibrary()">
                    <i class="fas fa-sync-alt"></i> রিফ্রেশ
                </button>
            </div>
            
            <div id="libList" class="fade-in">
                <!-- Library items will be loaded here -->
                <div class="empty-state">
                    <i class="fas fa-book"></i>
                    <h3>কোন ফাইল পাওয়া যায়নি</h3>
                    <p>এডমিন নতুন কন্টেন্ট যোগ করলে এখানে দেখানো হবে</p>
                </div>
            </div>
        </div>

        <!-- Admin View -->
        <div id="view-admin" class="view hidden">
            <div class="admin-header">
                <h2><i class="fas fa-user-shield"></i> অ্যাডমিন প্যানেল</h2>
                <button class="btn btn-sm btn-outline" onclick="showSec('view-library')">
                    <i class="fas fa-arrow-left"></i> লাইব্রেরিতে ফিরুন
                </button>
            </div>
            
            <div class="card fade-in">
                <div class="form-section">
                    <h4><i class="fas fa-plus-circle"></i> নতুন PDF/লিঙ্ক যোগ করুন</h4>
                    
                    <div>
                        <label for="libTitle">ফাইলের নাম *</label>
                        <input type="text" id="libTitle" placeholder="যেমন: পদার্থবিজ্ঞান ১ম পত্র, অধ্যায় ১">
                    </div>
                    
                    <div>
                        <label for="libType">ধরন নির্বাচন করুন</label>
                        <select id="libType">
                            <option value="PDF">PDF ডকুমেন্ট</option>
                            <option value="Video">ভিডিও লেসন</option>
                            <option value="Note">হ্যান্ড নোট</option>
                            <option value="Book">বই</option>
                            <option value="Solution">সলিউশন</option>
                        </select>
                    </div>
                    
                    <div>
                        <label>সরাসরি লিঙ্ক (Google Drive/Mediafire/Other)</label>
                        <input type="text" id="libLink" placeholder="https://drive.google.com/file/d/...">
                        <small style="color: var(--text-light); display: block; margin-top: -8px; margin-bottom: 16px;">
                            গুগল ড্রাইভ লিঙ্ক দিলে স্বয়ংক্রিয়ভাবে প্রিভিউ মোডে ওপেন হবে
                        </small>
                    </div>
                    
                    <div>
                        <label>অথবা ফাইল আপলোড করুন</label>
                        <div class="file-upload-area" onclick="document.getElementById('libFile').click()" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>ফাইল সিলেক্ট করতে ক্লিক করুন</p>
                            <small>PDF, MP4, DOCX অথবা ইমেজ ফাইল</small>
                            <div id="selectedFileName" class="file-name"></div>
                        </div>
                        <input type="file" id="libFile" accept=".pdf,.doc,.docx,.mp4,.jpg,.jpeg,.png" style="display: none;">
                        
                        <div id="uploadProgress" class="hidden">
                            <div class="flex-between mb-2">
                                <span>আপলোড হচ্ছে...</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" id="btnLibAdd" onclick="admAddLib()">
                        <i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন
                    </button>
                    
                    <div id="uploadStatus" class="text-center mt-3" style="min-height: 24px;"></div>
                </div>
            </div>
            
            <!-- Statistics Card -->
            <div class="card fade-in">
                <div class="form-section">
                    <h4><i class="fas fa-chart-bar"></i> স্ট্যাটিস্টিক্স</h4>
                    <div id="statsContent">
                        <p>মোট ফাইল: <span id="totalFiles">0</span></p>
                        <p>সর্বশেষ আপডেট: <span id="lastUpdate">-</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showSec('view-library')">
            <i class="fas fa-book"></i>
            <span>লাইব্রেরি</span>
        </div>
        <div class="nav-item" onclick="showSec('view-admin')">
            <i class="fas fa-user-shield"></i>
            <span>এডমিন</span>
        </div>
        <div class="nav-item" onclick="window.open('https://drive.google.com', '_blank')">
            <i class="fas fa-cloud"></i>
            <span>ড্রাইভ</span>
        </div>
        <div class="nav-item" onclick="showToast('সিস্টেম ইনফরমেশন', 'MRDS v6.2 - All rights reserved', 'info')">
            <i class="fas fa-info-circle"></i>
            <span>ইনফো</span>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <div>
            <strong id="toastTitle">সফল</strong>
            <p id="toastMessage">অপারেশন সফলভাবে সম্পন্ন হয়েছে</p>
        </div>
    </div>

    <script>
        // Firebase Configuration (Replace with your actual config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const storage = firebase.storage();

        // Global Variables
        let uploadTask = null;
        let fileUploadInProgress = false;

        // DOM Elements
        const libFileInput = document.getElementById('libFile');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const selectedFileName = document.getElementById('selectedFileName');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');
        const uploadStatus = document.getElementById('uploadStatus');

        // Initialize file upload handlers
        function initFileUpload() {
            libFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    selectedFileName.textContent = file.name + ' (' + formatFileSize(file.size) + ')';
                    fileUploadArea.classList.add('file-selected');
                    showToast('ফাইল সিলেক্টেড', `${file.name} সিলেক্ট করা হয়েছে`, 'success');
                }
            });
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Show toast notification
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('i');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // Set icon based on type
            toastIcon.className = type === 'success' ? 'fas fa-check-circle' : 
                                 type === 'error' ? 'fas fa-exclamation-circle' : 
                                 'fas fa-info-circle';
            
            // Set toast class
            toast.className = 'toast';
            toast.classList.add(type);
            toast.classList.add('show');
            
            // Auto hide after 4 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // Show section
        function showSec(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            // Set active nav item based on section
            if (id === 'view-library') {
                document.querySelector('.bottom-nav .nav-item:nth-child(1)').classList.add('active');
            } else if (id === 'view-admin') {
                document.querySelector('.bottom-nav .nav-item:nth-child(2)').classList.add('active');
            }
        }

        // Refresh library
        function refreshLibrary() {
            loadLibrary();
            showToast('রিফ্রেশ', 'লাইব্রেরি রিফ্রেশ করা হয়েছে', 'info');
        }

        // --- Admin: Save Data with File Upload ---
        async function admAddLib() {
            const title = document.getElementById('libTitle').value.trim();
            const link = document.getElementById('libLink').value.trim();
            const type = document.getElementById('libType').value;
            const btn = document.getElementById('btnLibAdd');
            const file = libFileInput.files[0];

            // Validation
            if (!title) {
                showToast('ত্রুটি', 'ফাইলের নাম দিন', 'error');
                document.getElementById('libTitle').focus();
                return;
            }

            // Check if either link or file is provided
            if (!link && !file) {
                showToast('ত্রুটি', 'লিঙ্ক দিন অথবা ফাইল সিলেক্ট করুন', 'error');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> প্রসেসিং...';
            uploadStatus.innerHTML = '';

            try {
                let finalLink = link;
                
                // If file is uploaded
                if (file) {
                    fileUploadInProgress = true;
                    
                    // Validate file type based on selected type
                    if (type === 'PDF' && !file.type.includes('pdf')) {
                        showToast('ত্রুটি', 'দয়া করে শুধুমাত্র PDF ফাইল আপলোড করুন', 'error');
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন';
                        return;
                    }
                    
                    // Show progress UI
                    uploadProgress.classList.remove('hidden');
                    uploadStatus.innerHTML = '<span style="color: var(--primary)">ফাইল আপলোড শুরু হচ্ছে...</span>';
                    
                    // Create storage reference
                    const storageRef = storage.ref();
                    const timestamp = Date.now();
                    const fileExtension = file.name.split('.').pop();
                    const fileName = `${timestamp}_${title.replace(/[^a-z0-9]/gi, '_')}.${fileExtension}`;
                    const fileRef = storageRef.child('library/' + fileName);
                    
                    // Upload file
                    uploadTask = fileRef.put(file);
                    
                    // Monitor upload progress
                    uploadTask.on('state_changed',
                        (snapshot) => {
                            // Update progress
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            progressBar.style.width = progress + '%';
                            progressPercent.textContent = Math.round(progress) + '%';
                            
                            // Update button text
                            btn.innerHTML = `<i class="fas fa-cloud-upload-alt"></i> আপলোডিং ${Math.round(progress)}%`;
                            
                            // Show status
                            const uploadedMB = (snapshot.bytesTransferred / (1024*1024)).toFixed(2);
                            const totalMB = (snapshot.totalBytes / (1024*1024)).toFixed(2);
                            uploadStatus.innerHTML = `<span style="color: var(--primary)">${uploadedMB} MB / ${totalMB} MB</span>`;
                        },
                        (error) => {
                            // Handle upload error
                            fileUploadInProgress = false;
                            uploadProgress.classList.add('hidden');
                            btn.disabled = false;
                            btn.innerHTML = '<i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন';
                            showToast('আপলোড ব্যর্থ', error.message, 'error');
                            uploadStatus.innerHTML = `<span style="color: var(--danger)">আপলোড ব্যর্থ: ${error.message}</span>`;
                        },
                        async () => {
                            // Upload complete
                            try {
                                const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                                finalLink = downloadURL;
                                
                                // Save to database
                                await saveToDatabase(title, finalLink, type, file.name, file.size);
                                
                                // Reset form
                                resetForm();
                                
                                // Update UI
                                fileUploadInProgress = false;
                                uploadProgress.classList.add('hidden');
                                btn.disabled = false;
                                btn.innerHTML = '<i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন';
                                uploadStatus.innerHTML = '<span style="color: var(--success)">সফলভাবে আপলোড ও সংরক্ষণ হয়েছে!</span>';
                                
                                showToast('সফল', 'ফাইল সফলভাবে আপলোড ও সংরক্ষণ হয়েছে', 'success');
                                
                                // Switch to library view
                                setTimeout(() => showSec('view-library'), 1000);
                                
                            } catch (dbError) {
                                showToast('ডাটাবেজ ত্রুটি', dbError.message, 'error');
                                btn.disabled = false;
                                btn.innerHTML = '<i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন';
                            }
                        }
                    );
                    
                    return; // Exit function, remaining will be handled in upload completion
                }
                
                // If no file, just save the link
                await saveToDatabase(title, finalLink, type);
                resetForm();
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন';
                showToast('সফল', 'লিঙ্ক সফলভাবে সংরক্ষণ হয়েছে', 'success');
                
            } catch (error) {
                showToast('ত্রুটি', error.message, 'error');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন';
            }
        }

        // Save data to Firebase Database
        async function saveToDatabase(title, link, type, fileName = '', fileSize = 0) {
            const itemData = {
                title: title,
                link: link,
                type: type,
                timestamp: Date.now(),
                addedBy: 'admin'
            };
            
            // Add file info if available
            if (fileName) {
                itemData.fileName = fileName;
                itemData.fileSize = fileSize;
                itemData.fileSizeFormatted = formatFileSize(fileSize);
            }
            
            // Save to database
            await db.ref('library').push(itemData);
            
            // Update stats
            updateStats();
        }

        // Reset form
        function resetForm() {
            document.getElementById('libTitle').value = '';
            document.getElementById('libLink').value = '';
            libFileInput.value = '';
            selectedFileName.textContent = '';
            fileUploadArea.classList.remove('file-selected');
            uploadProgress.classList.add('hidden');
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            uploadStatus.innerHTML = '';
        }

        // --- User: Load Library ---
        function loadLibrary() {
            db.ref('library').on('value', (snapshot) => {
                const listDiv = document.getElementById('libList');
                
                if (!snapshot.exists()) {
                    listDiv.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-book"></i>
                            <h3>কোন ফাইল পাওয়া যায়নি</h3>
                            <p>এডমিন নতুন কন্টেন্ট যোগ করলে এখানে দেখানো হবে</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                let totalFiles = 0;
                let latestTimestamp = 0;
                
                snapshot.forEach((child) => {
                    const data = child.val();
                    totalFiles++;
                    
                    if (data.timestamp > latestTimestamp) {
                        latestTimestamp = data.timestamp;
                    }
                    
                    // Get icon and color based on type
                    let icon = 'fa-file-pdf';
                    let iconClass = '';
                    if (data.type === 'Video') {
                        icon = 'fa-play-circle';
                        iconClass = 'video';
                    } else if (data.type === 'Note') {
                        icon = 'fa-file-alt';
                        iconClass = 'note';
                    } else if (data.type === 'Book') {
                        icon = 'fa-book';
                    } else if (data.type === 'Solution') {
                        icon = 'fa-check-circle';
                    }
                    
                    // Format date
                    const date = new Date(data.timestamp);
                    const dateStr = date.toLocaleDateString('bn-BD', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });
                    
                    html += `
                        <div class="card pdf-card fade-in">
                            <div class="pdf-icon ${iconClass}">
                                <i class="fas ${icon}"></i>
                            </div>
                            <div class="pdf-info">
                                <h4 class="pdf-title">${data.title}</h4>
                                <div class="pdf-meta">
                                    <span class="pdf-type">${data.type}</span>
                                    <span><i class="far fa-calendar"></i> ${dateStr}</span>
                                    ${data.fileSizeFormatted ? `<span><i class="fas fa-weight"></i> ${data.fileSizeFormatted}</span>` : ''}
                                </div>
                            </div>
                            <button class="btn btn-sm" onclick="openFile('${data.link}')">
                                <i class="fas fa-external-link-alt"></i> ওপেন
                            </button>
                        </div>
                    `;
                });
                
                listDiv.innerHTML = html;
                
                // Update stats
                document.getElementById('totalFiles').textContent = totalFiles;
                if (latestTimestamp > 0) {
                    const lastUpdate = new Date(latestTimestamp);
                    document.getElementById('lastUpdate').textContent = lastUpdate.toLocaleString('bn-BD');
                }
            });
        }

        // Open file/link
        function openFile(url) {
            if (!url) {
                showToast('ত্রুটি', 'লিঙ্ক পাওয়া যায়নি', 'error');
                return;
            }
            
            let finalUrl = url;
            
            // Handle Google Drive links for preview
            if (url.includes('drive.google.com') && url.includes('/file/d/')) {
                if (!url.includes('/preview')) {
                    finalUrl = url.replace('/file/d/', '/preview?id=').replace('/view?usp=drivesdk', '');
                }
            }
            
            // Open in new tab
            window.open(finalUrl, '_blank');
        }

        // Update statistics
        function updateStats() {
            // This will be updated when library loads
        }

        // Cancel upload if in progress
        function cancelUpload() {
            if (uploadTask && fileUploadInProgress) {
                uploadTask.cancel();
                fileUploadInProgress = false;
                uploadProgress.classList.add('hidden');
                document.getElementById('btnLibAdd').disabled = false;
                document.getElementById('btnLibAdd').innerHTML = '<i class="fas fa-save"></i> ডাটাবেজে সংরক্ষণ করুন';
                showToast('বাতিল', 'আপলোড বাতিল করা হয়েছে', 'info');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initFileUpload();
            loadLibrary();
            showToast('স্বাগতম', 'MRDS v6.2 লাইব্রেরিতে স্বাগতম', 'info');
            
            // Add cancel button event listener
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && fileUploadInProgress) {
                    cancelUpload();
                }
            });
        });

    </script>
</body>
</html>
