<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MRDS Ultimate v6.2 - Updated</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --primary: #4f46e5; --primary-dark: #3730a3;
            --bg: #f3f4f6; --surface: #ffffff; --text: #1f2937; --text-light: #6b7280;
            --border: #e5e7eb; --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); line-height: 1.5; padding-bottom: 80px; }
        .card { background: var(--surface); padding: 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 1rem; }
        .btn { background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; }
        .btn:disabled { background: var(--text-light); }
        input, select { width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 1rem; outline: none; }
        .hidden { display: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div id="adm-lib" class="card">
        <h4><i class="fas fa-book"></i> লাইব্রেরি (PDF যোগ করুন)</h4>
        <br>
        <input type="text" id="libTitle" placeholder="বই বা নোটের নাম">
        
        <label style="font-size: 12px; color: var(--text-light);">PDF লিঙ্ক অথবা ফাইল ব্যবহার করুন:</label>
        <input type="text" id="libLink" placeholder="Google Drive/Direct PDF Link">
        
        <select id="libType">
            <option value="PDF">PDF Document</option>
            <option value="Video">Video Lesson</option>
        </select>
        
        <button class="btn" id="btnLibAdd" onclick="admAddLib()">Save to Database</button>
    </div>

    <hr style="margin: 20px 0;">

    <div id="user-lib">
        <h4>আপনার লাইব্রেরি</h4>
        <div id="libList" style="margin-top: 15px;"></div>
    </div>
</div>

<script>
    // --- Admin Function: Add PDF ---
    async function admAddLib() {
        const title = document.getElementById('libTitle').value;
        const link = document.getElementById('libLink').value;
        const type = document.getElementById('libType').value;
        const btn = document.getElementById('btnLibAdd');

        if (!title || !link) {
            alert("দয়া করে শিরোনাম এবং লিঙ্ক দুটোই দিন।");
            return;
        }

        btn.disabled = true;
        btn.innerText = "সংরক্ষণ হচ্ছে...";

        try {
            await db.ref('library').push({
                title: title,
                link: link,
                type: type,
                timestamp: Date.now()
            });
            alert("সফলভাবে লাইব্রেরিতে যুক্ত হয়েছে!");
            document.getElementById('libTitle').value = '';
            document.getElementById('libLink').value = '';
        } catch (error) {
            alert("ভুল হয়েছে: " + error.message);
        } finally {
            btn.disabled = false;
            btn.innerText = "Save to Database";
        }
    }

    // --- User Function: Fetch & Show PDF List ---
    function fetchLibrary() {
        db.ref('library').on('value', (snapshot) => {
            const listDiv = document.getElementById('libList');
            listDiv.innerHTML = '';
            
            snapshot.forEach((child) => {
                const data = child.val();
                const item = document.createElement('div');
                item.className = 'card';
                item.style.padding = '10px';
                
                // PDF দেখার বাটন তৈরি
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${data.title}</strong><br>
                            <small style="color: grey;">Type: ${data.type}</small>
                        </div>
                        <button class="btn" style="width: auto; padding: 5px 15px;" 
                                onclick="openPDF('${data.link}')">
                            <i class="fas fa-file-pdf"></i> দেখুন
                        </button>
                    </div>
                `;
                listDiv.prepend(item);
            });
        });
    }

    // PDF খোলার ফাংশন
    function openPDF(url) {
        if (!url) return;
        // যদি গুগল ড্রাইভের লিঙ্ক হয় তবে এটি সরাসরি প্রিভিউ মোডে ওপেন হবে
        let finalUrl = url;
        if (url.includes('drive.google.com')) {
            finalUrl = url.replace('/view', '/preview');
        }
        window.open(finalUrl, '_blank');
    }

    // পেজ লোড হলে লাইব্রেরি ডেটা আনুন
    fetchLibrary();

</script>
    <script src="script.js"></script>
</body>
</html>
